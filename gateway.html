<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Gateway | Big Data Case Studies</title>
  <meta name="description" content="Chapter 8 Gateway | Big Data Case Studies" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Gateway | Big Data Case Studies" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Chapter 8 Gateway | Big Data Case Studies" />
  <meta name="github-repo" content="bchwtz/bchwtz-bdcs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Gateway | Big Data Case Studies" />
  
  <meta name="twitter:description" content="Chapter 8 Gateway | Big Data Case Studies" />
  

<meta name="author" content="Benjamin Buchwitz" />


<meta name="date" content="2022-03-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="external-flash-integration.html"/>
<link rel="next" href="backend.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><b>Big Data Case Studies</b></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction<span></span></a></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started<span></span></a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#sensor-dev-env"><i class="fa fa-check"></i><b>2.1</b> Sensor Dev Env<span></span></a><ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#software-setup"><i class="fa fa-check"></i><b>2.1.1</b> Software Setup<span></span></a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started.html"><a href="getting-started.html#hardware-setup"><i class="fa fa-check"></i><b>2.1.2</b> Hardware Setup<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#gateway-dev-env"><i class="fa fa-check"></i><b>2.2</b> Gateway Dev Env<span></span></a><ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started.html"><a href="getting-started.html#raspberry-connection-via-screen"><i class="fa fa-check"></i><b>2.2.1</b> Raspberry connection via screen<span></span></a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started.html"><a href="getting-started.html#raspberry-connection-without-a-screen-headless-setup"><i class="fa fa-check"></i><b>2.2.2</b> Raspberry connection without a screen (headless setup)<span></span></a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started.html"><a href="getting-started.html#set-up-putty-and-finalize-connection-to-raspberry"><i class="fa fa-check"></i><b>2.2.3</b> Set up PuTTY and finalize connection to Raspberry<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="setup-a-jupyterhub-on-your-raspberrypi.html"><a href="setup-a-jupyterhub-on-your-raspberrypi.html"><i class="fa fa-check"></i><b>3</b> Setup a Jupyterhub on your RaspberryPi<span></span></a><ul>
<li class="chapter" data-level="3.1" data-path="setup-a-jupyterhub-on-your-raspberrypi.html"><a href="setup-a-jupyterhub-on-your-raspberrypi.html#prepare-python-environment"><i class="fa fa-check"></i><b>3.1</b> Prepare Python environment<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="setup-a-jupyterhub-on-your-raspberrypi.html"><a href="setup-a-jupyterhub-on-your-raspberrypi.html#install-jupyterhub"><i class="fa fa-check"></i><b>3.2</b> Install JupyterHub<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="setup-a-jupyterhub-on-your-raspberrypi.html"><a href="setup-a-jupyterhub-on-your-raspberrypi.html#configure-jupyterhub-as-a-system-service"><i class="fa fa-check"></i><b>3.3</b> Configure JupyterHub as a system service<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pycharm.html"><a href="pycharm.html"><i class="fa fa-check"></i><b>4</b> PyCharm<span></span></a><ul>
<li class="chapter" data-level="4.1" data-path="pycharm.html"><a href="pycharm.html#pycharm-git-repository"><i class="fa fa-check"></i><b>4.1</b> PyCharm Git Repository<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="pycharm.html"><a href="pycharm.html#remotedeploy"><i class="fa fa-check"></i><b>4.2</b> RemoteDeploy<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="getting-started-package.html"><a href="getting-started-package.html"><i class="fa fa-check"></i><b>5</b> Getting Started Package<span></span></a><ul>
<li class="chapter" data-level="5.1" data-path="getting-started-package.html"><a href="getting-started-package.html#raspbery-pi-os-buster"><i class="fa fa-check"></i><b>5.1</b> Raspbery Pi OS “Buster”<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="getting-started-package.html"><a href="getting-started-package.html#board"><i class="fa fa-check"></i><b>5.2</b> Board<span></span></a><ul>
<li class="chapter" data-level="5.2.1" data-path="getting-started-package.html"><a href="getting-started-package.html#raspberry-pi-4---model-b"><i class="fa fa-check"></i><b>5.2.1</b> Raspberry Pi 4 - Model B<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="getting-started-package.html"><a href="getting-started-package.html#compute-model-4"><i class="fa fa-check"></i><b>5.2.2</b> Compute Model 4<span></span></a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Documentation<span></span></b></span></li>
<li class="chapter" data-level="6" data-path="sensor.html"><a href="sensor.html"><i class="fa fa-check"></i><b>6</b> Sensor<span></span></a><ul>
<li class="chapter" data-level="6.1" data-path="sensor.html"><a href="sensor.html#initializing-acceleration-logging"><i class="fa fa-check"></i><b>6.1</b> Initializing acceleration logging<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="sensor.html"><a href="sensor.html#retrieving-data-from-fifo"><i class="fa fa-check"></i><b>6.2</b> Retrieving data from FIFO<span></span></a></li>
<li class="chapter" data-level="6.3" data-path="sensor.html"><a href="sensor.html#using-the-data-by-hearbeat"><i class="fa fa-check"></i><b>6.3</b> Using the data by hearbeat<span></span></a></li>
<li class="chapter" data-level="6.4" data-path="sensor.html"><a href="sensor.html#initialization-during-boot"><i class="fa fa-check"></i><b>6.4</b> Initialization during boot<span></span></a></li>
<li class="chapter" data-level="6.5" data-path="sensor.html"><a href="sensor.html#streaming-of-acceleration-data"><i class="fa fa-check"></i><b>6.5</b> Streaming of acceleration data<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="sensor.html"><a href="sensor.html#heartbeat"><i class="fa fa-check"></i><b>6.6</b> Heartbeat<span></span></a></li>
<li class="chapter" data-level="6.7" data-path="sensor.html"><a href="sensor.html#implementation"><i class="fa fa-check"></i><b>6.7</b> Implementation<span></span></a><ul>
<li class="chapter" data-level="6.7.1" data-path="sensor.html"><a href="sensor.html#app_heartbeat.c"><i class="fa fa-check"></i><b>6.7.1</b> app_heartbeat.c<span></span></a></li>
<li class="chapter" data-level="6.7.2" data-path="sensor.html"><a href="sensor.html#app_accelerometer_logging.c"><i class="fa fa-check"></i><b>6.7.2</b> app_accelerometer_logging.c<span></span></a></li>
<li class="chapter" data-level="6.7.3" data-path="sensor.html"><a href="sensor.html#app_comms.c"><i class="fa fa-check"></i><b>6.7.3</b> app_comms.c<span></span></a></li>
<li class="chapter" data-level="6.7.4" data-path="sensor.html"><a href="sensor.html#ruuvi_nrf5_sdk15_communication_ble_gatt.c"><i class="fa fa-check"></i><b>6.7.4</b> ruuvi_nrf5_sdk15_communication_ble_gatt.c<span></span></a></li>
<li class="chapter" data-level="6.7.5" data-path="sensor.html"><a href="sensor.html#app_config.h"><i class="fa fa-check"></i><b>6.7.5</b> app_config.h<span></span></a></li>
<li class="chapter" data-level="6.7.6" data-path="sensor.html"><a href="sensor.html#app_sensor.c"><i class="fa fa-check"></i><b>6.7.6</b> app_sensor.c<span></span></a></li>
<li class="chapter" data-level="6.7.7" data-path="sensor.html"><a href="sensor.html#main.c"><i class="fa fa-check"></i><b>6.7.7</b> main.c<span></span></a></li>
<li class="chapter" data-level="6.7.8" data-path="sensor.html"><a href="sensor.html#ruuvi_interface_lis2dh12.c"><i class="fa fa-check"></i><b>6.7.8</b> ruuvi_interface_lis2dh12.c<span></span></a></li>
<li class="chapter" data-level="6.7.9" data-path="sensor.html"><a href="sensor.html#ruuvi_nrf5_sdk_rtc_mcu.c"><i class="fa fa-check"></i><b>6.7.9</b> ruuvi_nrf5_sdk_rtc_mcu.c<span></span></a></li>
<li class="chapter" data-level="6.7.10" data-path="sensor.html"><a href="sensor.html#ruuvi_nrf5_sdk15_power.c-ruuvi_nrf5_sdk15_power.h"><i class="fa fa-check"></i><b>6.7.10</b> ruuvi_nrf5_sdk15_power.c / ruuvi_nrf5_sdk15_power.h<span></span></a></li>
<li class="chapter" data-level="6.7.11" data-path="sensor.html"><a href="sensor.html#ruuvi_task_flash_ringbuffer.c"><i class="fa fa-check"></i><b>6.7.11</b> ruuvi_task_flash_ringbuffer.c<span></span></a></li>
<li class="chapter" data-level="6.7.12" data-path="sensor.html"><a href="sensor.html#ruuvi_task_flashdb.c"><i class="fa fa-check"></i><b>6.7.12</b> ruuvi_task_flashdb.c<span></span></a></li>
<li class="chapter" data-level="6.7.13" data-path="sensor.html"><a href="sensor.html#app_button.c"><i class="fa fa-check"></i><b>6.7.13</b> app_button.c<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="sensor.html"><a href="sensor.html#energy-consumption"><i class="fa fa-check"></i><b>6.8</b> Energy consumption<span></span></a></li>
<li class="chapter" data-level="6.9" data-path="sensor.html"><a href="sensor.html#firmware-packaging"><i class="fa fa-check"></i><b>6.9</b> Firmware packaging<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="external-flash-integration.html"><a href="external-flash-integration.html"><i class="fa fa-check"></i><b>7</b> External Flash Integration<span></span></a><ul>
<li class="chapter" data-level="7.1" data-path="external-flash-integration.html"><a href="external-flash-integration.html#macronix-flash"><i class="fa fa-check"></i><b>7.1</b> Macronix Flash<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="external-flash-integration.html"><a href="external-flash-integration.html#database-vs.-filesystem"><i class="fa fa-check"></i><b>7.2</b> Database vs. Filesystem<span></span></a><ul>
<li class="chapter" data-level="7.2.1" data-path="external-flash-integration.html"><a href="external-flash-integration.html#flashdb"><i class="fa fa-check"></i><b>7.2.1</b> FlashDB <img src="gfx/org/flashdb.png" /><span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="external-flash-integration.html"><a href="external-flash-integration.html#implementation-1"><i class="fa fa-check"></i><b>7.3</b> Implementation<span></span></a><ul>
<li class="chapter" data-level="7.3.1" data-path="external-flash-integration.html"><a href="external-flash-integration.html#flashdb-api"><i class="fa fa-check"></i><b>7.3.1</b> FlashDB API<span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="external-flash-integration.html"><a href="external-flash-integration.html#data-base-config-files"><i class="fa fa-check"></i><b>7.3.2</b> Data Base config files<span></span></a></li>
<li class="chapter" data-level="7.3.3" data-path="external-flash-integration.html"><a href="external-flash-integration.html#macronix-low-level-driver-functions"><i class="fa fa-check"></i><b>7.3.3</b> Macronix low level driver functions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="external-flash-integration.html"><a href="external-flash-integration.html#flashdb-evaluation"><i class="fa fa-check"></i><b>7.4</b> FlashDB evaluation<span></span></a><ul>
<li class="chapter" data-level="7.4.1" data-path="external-flash-integration.html"><a href="external-flash-integration.html#amount-of-data-wich-can-be-stored"><i class="fa fa-check"></i><b>7.4.1</b> Amount of data wich can be stored<span></span></a></li>
<li class="chapter" data-level="7.4.2" data-path="external-flash-integration.html"><a href="external-flash-integration.html#energy-consumption-1"><i class="fa fa-check"></i><b>7.4.2</b> Energy consumption<span></span></a></li>
<li class="chapter" data-level="7.4.3" data-path="external-flash-integration.html"><a href="external-flash-integration.html#github-issue-11-write-performance-on-external-flash"><i class="fa fa-check"></i><b>7.4.3</b> GitHub Issue #11 Write Performance on External Flash<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gateway.html"><a href="gateway.html"><i class="fa fa-check"></i><b>8</b> Gateway<span></span></a><ul>
<li class="chapter" data-level="8.1" data-path="gateway.html"><a href="gateway.html#sensor-gateway-communication-library"><i class="fa fa-check"></i><b>8.1</b> Sensor Gateway Communication Library<span></span></a><ul>
<li class="chapter" data-level="8.1.1" data-path="gateway.html"><a href="gateway.html#activate-acceleration-logging"><i class="fa fa-check"></i><b>8.1.1</b> Activate acceleration logging<span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="gateway.html"><a href="gateway.html#deactivate-acceleration-logging"><i class="fa fa-check"></i><b>8.1.2</b> Deactivate acceleration logging<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="gateway.html"><a href="gateway.html#set-sensor-configuration"><i class="fa fa-check"></i><b>8.1.3</b> Set sensor configuration<span></span></a></li>
<li class="chapter" data-level="8.1.4" data-path="gateway.html"><a href="gateway.html#set-sensor-time"><i class="fa fa-check"></i><b>8.1.4</b> Set sensor time<span></span></a></li>
<li class="chapter" data-level="8.1.5" data-path="gateway.html"><a href="gateway.html#get-sensor-configuration"><i class="fa fa-check"></i><b>8.1.5</b> Get sensor configuration<span></span></a></li>
<li class="chapter" data-level="8.1.6" data-path="gateway.html"><a href="gateway.html#get-sensor-time"><i class="fa fa-check"></i><b>8.1.6</b> Get sensor time<span></span></a></li>
<li class="chapter" data-level="8.1.7" data-path="gateway.html"><a href="gateway.html#get-acceleration-data"><i class="fa fa-check"></i><b>8.1.7</b> Get acceleration data<span></span></a></li>
<li class="chapter" data-level="8.1.8" data-path="gateway.html"><a href="gateway.html#get-flash-statistics"><i class="fa fa-check"></i><b>8.1.8</b> Get flash statistics<span></span></a></li>
<li class="chapter" data-level="8.1.9" data-path="gateway.html"><a href="gateway.html#get-logging-status"><i class="fa fa-check"></i><b>8.1.9</b> Get logging status<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="gateway.html"><a href="gateway.html#advertisement-logging"><i class="fa fa-check"></i><b>8.2</b> Advertisement logging<span></span></a></li>
<li class="chapter" data-level="8.3" data-path="gateway.html"><a href="gateway.html#data-storage-format"><i class="fa fa-check"></i><b>8.3</b> Data storage format<span></span></a><ul>
<li class="chapter" data-level="8.3.1" data-path="gateway.html"><a href="gateway.html#csv-file-acceleration-logging"><i class="fa fa-check"></i><b>8.3.1</b> Csv file acceleration Logging<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="gateway.html"><a href="gateway.html#csv-file-advertisement-logging"><i class="fa fa-check"></i><b>8.3.2</b> Csv file advertisement Logging<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="backend.html"><a href="backend.html"><i class="fa fa-check"></i><b>9</b> Backend<span></span></a></li>
<li class="chapter" data-level="10" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html"><i class="fa fa-check"></i><b>10</b> BLE GATT Messages<span></span></a><ul>
<li class="chapter" data-level="10.1" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#general-message-structure"><i class="fa fa-check"></i><b>10.1</b> General message structure<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#control-messages"><i class="fa fa-check"></i><b>10.2</b> Control messages<span></span></a><ul>
<li class="chapter" data-level="10.2.1" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#set-heartbeat"><i class="fa fa-check"></i><b>10.2.1</b> Set heartbeat<span></span></a></li>
<li class="chapter" data-level="10.2.2" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#get-heartbeat"><i class="fa fa-check"></i><b>10.2.2</b> Get heartbeat<span></span></a></li>
<li class="chapter" data-level="10.2.3" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#start-transmitting-acceleration-data"><i class="fa fa-check"></i><b>10.2.3</b> Start transmitting acceleration data<span></span></a></li>
<li class="chapter" data-level="10.2.4" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#set-configuration-of-acceleration-sensor"><i class="fa fa-check"></i><b>10.2.4</b> Set configuration of acceleration sensor<span></span></a></li>
<li class="chapter" data-level="10.2.5" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#read-configuration-of-acceleration-sensor"><i class="fa fa-check"></i><b>10.2.5</b> Read configuration of acceleration sensor<span></span></a></li>
<li class="chapter" data-level="10.2.6" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#set-system-time"><i class="fa fa-check"></i><b>10.2.6</b> Set system time<span></span></a></li>
<li class="chapter" data-level="10.2.7" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#read-system-time"><i class="fa fa-check"></i><b>10.2.7</b> Read system time<span></span></a></li>
<li class="chapter" data-level="10.2.8" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#control-acceleration-logging"><i class="fa fa-check"></i><b>10.2.8</b> Control acceleration logging<span></span></a></li>
<li class="chapter" data-level="10.2.9" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#query-status-of-acceleration-logging"><i class="fa fa-check"></i><b>10.2.9</b> Query status of acceleration logging<span></span></a></li>
<li class="chapter" data-level="10.2.10" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#query-flash-statistic"><i class="fa fa-check"></i><b>10.2.10</b> Query flash statistic<span></span></a></li>
<li class="chapter" data-level="10.2.11" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#query-boot-counter"><i class="fa fa-check"></i><b>10.2.11</b> Query boot counter<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#response-messages"><i class="fa fa-check"></i><b>10.3</b> Response messages<span></span></a><ul>
<li class="chapter" data-level="10.3.1" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#status-response"><i class="fa fa-check"></i><b>10.3.1</b> Status response<span></span></a></li>
<li class="chapter" data-level="10.3.2" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#end-of-data-message"><i class="fa fa-check"></i><b>10.3.2</b> End of data message<span></span></a></li>
<li class="chapter" data-level="10.3.3" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#configuration-response"><i class="fa fa-check"></i><b>10.3.3</b> Configuration response<span></span></a></li>
<li class="chapter" data-level="10.3.4" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#timestamp-response"><i class="fa fa-check"></i><b>10.3.4</b> Timestamp response<span></span></a></li>
<li class="chapter" data-level="10.3.5" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#flash-statistic-response"><i class="fa fa-check"></i><b>10.3.5</b> Flash statistic response<span></span></a></li>
<li class="chapter" data-level="10.3.6" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#boot-counter-response"><i class="fa fa-check"></i><b>10.3.6</b> boot counter response<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#data-message"><i class="fa fa-check"></i><b>10.4</b> Data message<span></span></a><ul>
<li class="chapter" data-level="10.4.1" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#bit-data-format"><i class="fa fa-check"></i><b>10.4.1</b> 12 bit data format<span></span></a></li>
<li class="chapter" data-level="10.4.2" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#bit-data-format-1"><i class="fa fa-check"></i><b>10.4.2</b> 10 bit data format<span></span></a></li>
<li class="chapter" data-level="10.4.3" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#bit-data-format-2"><i class="fa fa-check"></i><b>10.4.3</b> 8 bit data format<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#communication-example"><i class="fa fa-check"></i><b>10.5</b> Communication example<span></span></a></li>
<li class="chapter" data-level="10.6" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#streaming"><i class="fa fa-check"></i><b>10.6</b> Streaming<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="messageobjects.html"><a href="messageobjects.html"><i class="fa fa-check"></i><b>11</b> MessageObjects<span></span></a><ul>
<li class="chapter" data-level="11.1" data-path="messageobjects.html"><a href="messageobjects.html#return_values_from_sensor"><i class="fa fa-check"></i><b>11.1</b> return_values_from_sensor<span></span></a></li>
<li class="chapter" data-level="11.2" data-path="messageobjects.html"><a href="messageobjects.html#send_msg_object"><i class="fa fa-check"></i><b>11.2</b> send_msg_object<span></span></a></li>
</ul></li>
<li class="part"><span><b>To Do<span></span></b></span></li>
<li class="chapter" data-level="12" data-path="sensor-1.html"><a href="sensor-1.html"><i class="fa fa-check"></i><b>12</b> Sensor<span></span></a><ul>
<li class="chapter" data-level="12.1" data-path="sensor-1.html"><a href="sensor-1.html#hardware"><i class="fa fa-check"></i><b>12.1</b> Hardware<span></span></a><ul>
<li class="chapter" data-level="12.1.1" data-path="sensor-1.html"><a href="sensor-1.html#external-flash-memory"><i class="fa fa-check"></i><b>12.1.1</b> External Flash Memory<span></span></a></li>
<li class="chapter" data-level="12.1.2" data-path="sensor-1.html"><a href="sensor-1.html#board-redesign"><i class="fa fa-check"></i><b>12.1.2</b> Board Redesign<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="sensor-1.html"><a href="sensor-1.html#software"><i class="fa fa-check"></i><b>12.2</b> Software<span></span></a><ul>
<li class="chapter" data-level="12.2.1" data-path="sensor-1.html"><a href="sensor-1.html#general-todo"><i class="fa fa-check"></i><b>12.2.1</b> General ToDo<span></span></a></li>
<li class="chapter" data-level="12.2.2" data-path="sensor-1.html"><a href="sensor-1.html#security"><i class="fa fa-check"></i><b>12.2.2</b> Security<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gateway-1.html"><a href="gateway-1.html"><i class="fa fa-check"></i><b>13</b> Gateway<span></span></a><ul>
<li class="chapter" data-level="13.1" data-path="gateway-1.html"><a href="gateway-1.html#hardware-1"><i class="fa fa-check"></i><b>13.1</b> Hardware<span></span></a><ul>
<li class="chapter" data-level="13.1.1" data-path="gateway-1.html"><a href="gateway-1.html#uninterruptible-power-supply"><i class="fa fa-check"></i><b>13.1.1</b> Uninterruptible Power Supply<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="gateway-1.html"><a href="gateway-1.html#camera"><i class="fa fa-check"></i><b>13.1.2</b> Camera<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="gateway-1.html"><a href="gateway-1.html#g4g5g-module"><i class="fa fa-check"></i><b>13.1.3</b> 3g/4g/5g Module<span></span></a></li>
<li class="chapter" data-level="13.1.4" data-path="gateway-1.html"><a href="gateway-1.html#bluetooth-hardware"><i class="fa fa-check"></i><b>13.1.4</b> Bluetooth Hardware<span></span></a></li>
<li class="chapter" data-level="13.1.5" data-path="gateway-1.html"><a href="gateway-1.html#case"><i class="fa fa-check"></i><b>13.1.5</b> Case<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="gateway-1.html"><a href="gateway-1.html#software-1"><i class="fa fa-check"></i><b>13.2</b> Software<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="backend-1.html"><a href="backend-1.html"><i class="fa fa-check"></i><b>14</b> Backend<span></span></a></li>
<li class="part"><span><b>Appendix<span></span></b></span></li>
<li><a href="contributors.html#contributors">Contributors<span></span></a><ul>
<li><a href="contributors.html#ws-2020-2021">WS 2020 / 2021<span></span></a></li>
<li><a href="contributors.html#ss-2021">SS 2021<span></span></a></li>
<li><a href="contributors.html#ws-2021-2022">WS 2021 / 2022<span></span></a></li>
</ul></li>
<li><a href="commerical-applications.html#commerical-applications">Commerical Applications<span></span></a><ul>
<li><a href="commerical-applications.html#literature">Literature<span></span></a></li>
<li class="chapter" data-level="14.1" data-path="commerical-applications.html"><a href="commerical-applications.html"><i class="fa fa-check"></i><b>14.1</b> Merging<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="caveates.html"><a href="caveates.html"><i class="fa fa-check"></i><b>15</b> Caveates<span></span></a></li>
<li class="chapter" data-level="16" data-path="dontt-do-feature-master.html"><a href="dontt-do-feature-master.html"><i class="fa fa-check"></i><b>16</b> DONT’T DO : feature =&gt; master<span></span></a></li>
<li class="chapter" data-level="17" data-path="do-master-feature-master.html"><a href="do-master-feature-master.html"><i class="fa fa-check"></i><b>17</b> DO : master =&gt; feature =&gt; master<span></span></a></li>
<li><a href="system-info.html#system-info">System Info<span></span></a></li>
<li class="divider"></li>
<li><a href="http://www.bchwtz.de" target="blank"><center>www.<b>BCHWTZ</b>.de</center></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Case Studies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gateway" class="section level1 hasAnchor">
<h1><span class="header-section-number">Chapter 8</span> Gateway<a href="gateway.html#gateway" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The gateway has three different tasks:</p>
<ol style="list-style-type: decimal">
<li>Manipulate the state of one or more sensors via control messages</li>
<li>Receive acceleration data from one or more sensors, parse and store them</li>
<li>Logging Bluetooth advertisements from sensors</li>
</ol>
<p>For the first two tasks there is the “SensorGatewayBleak” library. All Code is written in python. You need the following libraries to run the “SensorGatewayBleak” library:</p>
<pre><code>asyncio
nest_asyncio
bleak 
bluez 
crcmod</code></pre>
<p>The “AdvertisementLogging” function need the following libraries:</p>
<pre><code>ruuvitag_sensor
bluez    
pygatt</code></pre>
<div id="sensor-gateway-communication-library" class="section level2 hasAnchor">
<h2><span class="header-section-number">8.1</span> Sensor Gateway Communication Library<a href="gateway.html#sensor-gateway-communication-library" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This library is used for communication between the gateway and the sensors. It sends messages to the sensor to change their state or to get their data. The library has the following functions. This functions take message objects as argument. This message object must fit the needed message object to be processed.</p>
<div id="activate-acceleration-logging" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.1</span> Activate acceleration logging<a href="gateway.html#activate-acceleration-logging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The “activate_logging_at_sensor()” function activates logging at all sensors in Bluetooth range of the gateway. It takes a send_activate_logging_object as argument. To activate the logging, the gateway sends a control acceleration logging (<a href="ble-gatt-messages.html#control-acceleration-logging">10.2.8</a>) message to the target sensor via the send_activate_logging_object. The message content is <code>0x4A 0x4A 0x08 0x01</code>. If Logging is already activated an error message (<a href="ble-gatt-messages.html#status-response">10.3.1</a>) will be received as a status_object.</p>
</div>
<div id="deactivate-acceleration-logging" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.2</span> Deactivate acceleration logging<a href="gateway.html#deactivate-acceleration-logging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The “deactivate_logging_at_sensor()” function deactivates logging at all sensors in Bluetooth range. It takes a send_deactivate_logging_object as argument. To deactivate the logging, the gateway sends a control acceleration logging (<a href="ble-gatt-messages.html#control-acceleration-logging">10.2.8</a>) message to the target sensor via the send_deactivate_logging_object. The message content is <code>0x4A 0x4A 0x08 0x00</code>. Stopping the logging cause a deletion of all flash pages. If Logging is not activated an error message (<a href="ble-gatt-messages.html#status-response">10.3.1</a>) will be received a status_object.</p>
</div>
<div id="set-sensor-configuration" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.3</span> Set sensor configuration<a href="gateway.html#set-sensor-configuration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With the “set_config_sensor()” function three sensor properties can be manipulated:</p>
<ol style="list-style-type: decimal">
<li>Sampling rate (sampling_rate): Measuring interval of the sensor. Allowed values can be found in Chapter (<a href="ble-gatt-messages.html#set-configuration-of-acceleration-sensor">10.2.4</a>).</li>
<li>Sampling resolution (sampling_resolution): Resolution of the measured values. Allowed values can be found in Chapter (<a href="ble-gatt-messages.html#set-configuration-of-acceleration-sensor">10.2.4</a>).</li>
<li>Measuring range(measuring_range): Measuring range. Allowed values can be found in Chapter (<a href="ble-gatt-messages.html#set-configuration-of-acceleration-sensor">10.2.4</a>). The returned message will be saved in a status message object.</li>
<li>Frequenzy divider(divider): The divider is used to get sample frequencies that are not supported by the sampling rate.</li>
</ol>
<p>The configuration will be sent via a “Set configuration of acceleration sensor” (<a href="ble-gatt-messages.html#set-configuration-of-acceleration-sensor">10.2.4</a>) message to all sensors in Bluetooth range. It takes a send_set_config_object as argument.
Only arguments with allowed values will be set. All others stay as they are. After setting the configuration all flash pages will be deleted. This can cause a loss of data. The Sensor send a status response message (<a href="ble-gatt-messages.html#status-response">10.3.1</a>) to the gateway if the configuration was set successful or not. The returned message will be saved as a status_object.</p>
</div>
<div id="set-sensor-time" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.4</span> Set sensor time<a href="gateway.html#set-sensor-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With the “set_sensor_time() “ function all sensors in Bluetooth range will be set to the current time in UTC. It takes a send_set_sensor_time_object as argument. To set the sensor time a “Set system time” (<a href="ble-gatt-messages.html#set-system-time">10.2.6</a>) message, with the current time, will be send via send_set_sensor_time_object. After setting the sensor time all flash pages will be deleted. This can cause a loss of data. The Sensor send a response message (@ref(ble-gatt-messages.html#status-response)) to the gateway if the time was set successful or not. The returned message will be saved in a status_object.</p>
</div>
<div id="get-sensor-configuration" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.5</span> Get sensor configuration<a href="gateway.html#get-sensor-configuration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The “get_config_from_sensor()”send a “Read configuration of acceleration sensor” (<a href="ble-gatt-messages.html#read-configuration-of-acceleration-sensor">10.2.5</a>) message to the target sensor via a send_get_config_object. The sensor returns with a “Configuration response” (<a href="ble-gatt-messages.html#configuration-response">10.3.3</a>) message which is storred in config_object.</p>
</div>
<div id="get-sensor-time" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.6</span> Get sensor time<a href="gateway.html#get-sensor-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The “get_time_from_sensor()” function returns the current time from all sensors in Bluetooth range as a time_object. It takes a send_get_senor_time_object as argument. The function sends a “Read system time” (<a href="ble-gatt-messages.html#read-system-time">10.2.7</a>) message to all targets and receives “Timestamp response” (<a href="ble-gatt-messages.html#timestamp-response">10.3.4</a>) messages which is stored in a time_object.</p>
</div>
<div id="get-acceleration-data" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.7</span> Get acceleration data<a href="gateway.html#get-acceleration-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The “get_acceleration_data()” collect all samples from the defined mac adresses in the send_get_acceleration_data_object in Bluethooth range. It returns a advertisement_data_object. To do this, the gateway sends a “Start transmitting logged data” (<a href="#start-transmitting-logged-data"><strong>??</strong></a> Message to all targets and receives the data which are followed by an “End of data message” (<a href="ble-gatt-messages.html#end-of-data-message">10.3.2</a>). The returned Message will be saved in an acceloration_data_object.</p>
</div>
<div id="get-flash-statistics" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.8</span> Get flash statistics<a href="gateway.html#get-flash-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>With the “get_flash_statistic()” function you can access important information from the internal flash memory of the sensor (<a href="ble-gatt-messages.html#query-flash-statistic">10.2.10</a>). It takes a send_get_flash_statistics_object as argument.The returned message will be saved in a flash_statistics_object.</p>
</div>
<div id="get-logging-status" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.1.9</span> Get logging status<a href="gateway.html#get-logging-status" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The “get_logging_status()” function is used to identify if a sensor is currently logging or if logging is deactivated. It returns a status_object. It takes a send_get_logging_status_object as argument.</p>
<pre><code>1 = logging is active
0 = logging is not active</code></pre>
</div>
</div>
<div id="advertisement-logging" class="section level2 hasAnchor">
<h2><span class="header-section-number">8.2</span> Advertisement logging<a href="gateway.html#advertisement-logging" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This executable is used for logging all advertisements that are send from any sensor in the Bluetooth rang. It parses the messages the gateway receives in a human readable design and stores it in a Csv file. The “decode_data()” function from the ruuvitag_sensor library is used to parse the received messages from the sensors.</p>
</div>
<div id="data-storage-format" class="section level2 hasAnchor">
<h2><span class="header-section-number">8.3</span> Data storage format<a href="gateway.html#data-storage-format" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For an easy access, the received advertisement data is stored in csv files.
Acceleration data can be saved in csv as well or store the acceleration data message object. We recommend the following structure to save the files:</p>
<div id="csv-file-acceleration-logging" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.3.1</span> Csv file acceleration Logging<a href="gateway.html#csv-file-acceleration-logging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Five values will be stored in these Csv files. These values are:</p>
<pre><code>•   Acceleration in X directory
•   Acceleration in Y directory
•   Acceleration in Z directory
•   Timestamp
•   Mac address</code></pre>
<p>The name of the Csv file will be “acceleration” plus the observation time.</p>
</div>
<div id="csv-file-advertisement-logging" class="section level3 hasAnchor">
<h3><span class="header-section-number">8.3.2</span> Csv file advertisement Logging<a href="gateway.html#csv-file-advertisement-logging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fourteen values will be stored in these Csv files. These values are:</p>
<pre><code>•   Data format
•   Humidity
•   Temperature in °C
•   Pressure in Pa
•   Acceleration
•   Acceleration in X directory
•   Acceleration in Y directory
•   Acceleration in Z directory
•   Tx power in dBm
•   Battery in mV
•   Movement counter
•   Measurement sequence
•   Mac address
•   Timestamp</code></pre>
<p>The name of the Csv file is the date of the observation. One Csv file will only include observations from one day.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="external-flash-integration.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="backend.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/12-docs-gateway.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bchwtz-bdcs.pdf", "bchwtz-bdcs.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
