<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 BLE GATT Messages | Big Data Case Studies</title>
  <meta name="description" content="Chapter 9 BLE GATT Messages | Big Data Case Studies" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 BLE GATT Messages | Big Data Case Studies" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 9 BLE GATT Messages | Big Data Case Studies" />
  <meta name="github-repo" content="bchwtz/bchwtz-bdcs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 BLE GATT Messages | Big Data Case Studies" />
  
  <meta name="twitter:description" content="Chapter 9 BLE GATT Messages | Big Data Case Studies" />
  

<meta name="author" content="Benjamin Buchwitz" />


<meta name="date" content="2021-11-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="backend.html"/>
<link rel="next" href="messageobjects.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><b>Big Data Case Studies</b></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#sensor-dev-env"><i class="fa fa-check"></i><b>2.1</b> Sensor Dev Env</a><ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#software-setup"><i class="fa fa-check"></i><b>2.1.1</b> Software Setup</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started.html"><a href="getting-started.html#hardware-setup"><i class="fa fa-check"></i><b>2.1.2</b> Hardware Setup</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#gateway-dev-env"><i class="fa fa-check"></i><b>2.2</b> Gateway Dev Env</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="setup-a-jupyterhub-on-your-raspberrypi.html"><a href="setup-a-jupyterhub-on-your-raspberrypi.html"><i class="fa fa-check"></i><b>3</b> Setup a Jupyterhub on your RaspberryPi</a><ul>
<li class="chapter" data-level="3.1" data-path="setup-a-jupyterhub-on-your-raspberrypi.html"><a href="setup-a-jupyterhub-on-your-raspberrypi.html#prepare-python-environment"><i class="fa fa-check"></i><b>3.1</b> Prepare Python environment</a></li>
<li class="chapter" data-level="3.2" data-path="setup-a-jupyterhub-on-your-raspberrypi.html"><a href="setup-a-jupyterhub-on-your-raspberrypi.html#install-jupyterhub"><i class="fa fa-check"></i><b>3.2</b> Install JupyterHub</a></li>
<li class="chapter" data-level="3.3" data-path="setup-a-jupyterhub-on-your-raspberrypi.html"><a href="setup-a-jupyterhub-on-your-raspberrypi.html#configure-jupyterhub-as-a-system-service"><i class="fa fa-check"></i><b>3.3</b> Configure JupyterHub as a system service</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pycharm.html"><a href="pycharm.html"><i class="fa fa-check"></i><b>4</b> PyCharm</a><ul>
<li class="chapter" data-level="4.1" data-path="pycharm.html"><a href="pycharm.html#pycharm-git-repository"><i class="fa fa-check"></i><b>4.1</b> PyCharm Git Repository</a></li>
<li class="chapter" data-level="4.2" data-path="pycharm.html"><a href="pycharm.html#remotedeploy"><i class="fa fa-check"></i><b>4.2</b> RemoteDeploy</a></li>
</ul></li>
<li class="part"><span><b>Documentation</b></span></li>
<li class="chapter" data-level="5" data-path="sensor.html"><a href="sensor.html"><i class="fa fa-check"></i><b>5</b> Sensor</a><ul>
<li class="chapter" data-level="5.1" data-path="sensor.html"><a href="sensor.html#initializing-acceleration-logging"><i class="fa fa-check"></i><b>5.1</b> Initializing acceleration logging</a></li>
<li class="chapter" data-level="5.2" data-path="sensor.html"><a href="sensor.html#retrieving-data-from-fifo"><i class="fa fa-check"></i><b>5.2</b> Retrieving data from FIFO</a></li>
<li class="chapter" data-level="5.3" data-path="sensor.html"><a href="sensor.html#using-the-data-by-hearbeat"><i class="fa fa-check"></i><b>5.3</b> Using the data by hearbeat</a></li>
<li class="chapter" data-level="5.4" data-path="sensor.html"><a href="sensor.html#initialization-during-boot"><i class="fa fa-check"></i><b>5.4</b> Initialization during boot</a></li>
<li class="chapter" data-level="5.5" data-path="sensor.html"><a href="sensor.html#streaming-of-acceleration-data"><i class="fa fa-check"></i><b>5.5</b> Streaming of acceleration data</a></li>
<li class="chapter" data-level="5.6" data-path="sensor.html"><a href="sensor.html#implementation"><i class="fa fa-check"></i><b>5.6</b> Implementation</a><ul>
<li class="chapter" data-level="5.6.1" data-path="sensor.html"><a href="sensor.html#app_accelerometer_logging.c"><i class="fa fa-check"></i><b>5.6.1</b> app_accelerometer_logging.c</a></li>
<li class="chapter" data-level="5.6.2" data-path="sensor.html"><a href="sensor.html#app_comms.c"><i class="fa fa-check"></i><b>5.6.2</b> app_comms.c</a></li>
<li class="chapter" data-level="5.6.3" data-path="sensor.html"><a href="sensor.html#ruuvi_nrf5_sdk15_communication_ble_gatt.c"><i class="fa fa-check"></i><b>5.6.3</b> ruuvi_nrf5_sdk15_communication_ble_gatt.c</a></li>
<li class="chapter" data-level="5.6.4" data-path="sensor.html"><a href="sensor.html#app_config.h"><i class="fa fa-check"></i><b>5.6.4</b> app_config.h</a></li>
<li class="chapter" data-level="5.6.5" data-path="sensor.html"><a href="sensor.html#app_sensor.c"><i class="fa fa-check"></i><b>5.6.5</b> app_sensor.c</a></li>
<li class="chapter" data-level="5.6.6" data-path="sensor.html"><a href="sensor.html#main.c"><i class="fa fa-check"></i><b>5.6.6</b> main.c</a></li>
<li class="chapter" data-level="5.6.7" data-path="sensor.html"><a href="sensor.html#ruuvi_interface_lis2dh12.c"><i class="fa fa-check"></i><b>5.6.7</b> ruuvi_interface_lis2dh12.c</a></li>
<li class="chapter" data-level="5.6.8" data-path="sensor.html"><a href="sensor.html#ruuvi_nrf5_sdk_rtc_mcu.c"><i class="fa fa-check"></i><b>5.6.8</b> ruuvi_nrf5_sdk_rtc_mcu.c</a></li>
<li class="chapter" data-level="5.6.9" data-path="sensor.html"><a href="sensor.html#ruuvi_nrf5_sdk15_power.c-ruuvi_nrf5_sdk15_power.h"><i class="fa fa-check"></i><b>5.6.9</b> ruuvi_nrf5_sdk15_power.c / ruuvi_nrf5_sdk15_power.h</a></li>
<li class="chapter" data-level="5.6.10" data-path="sensor.html"><a href="sensor.html#ruuvi_task_flash_ringbuffer.c"><i class="fa fa-check"></i><b>5.6.10</b> ruuvi_task_flash_ringbuffer.c</a></li>
<li class="chapter" data-level="5.6.11" data-path="sensor.html"><a href="sensor.html#ruuvi_task_flashdb.c"><i class="fa fa-check"></i><b>5.6.11</b> ruuvi_task_flashdb.c</a></li>
<li class="chapter" data-level="5.6.12" data-path="sensor.html"><a href="sensor.html#app_button.c"><i class="fa fa-check"></i><b>5.6.12</b> app_button.c</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="sensor.html"><a href="sensor.html#energy-consumption"><i class="fa fa-check"></i><b>5.7</b> Energy consumption</a></li>
<li class="chapter" data-level="5.8" data-path="sensor.html"><a href="sensor.html#firmware-packaging"><i class="fa fa-check"></i><b>5.8</b> Firmware packaging</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="external-flash-integration.html"><a href="external-flash-integration.html"><i class="fa fa-check"></i><b>6</b> External Flash Integration</a><ul>
<li class="chapter" data-level="6.1" data-path="external-flash-integration.html"><a href="external-flash-integration.html#macronix-flash"><i class="fa fa-check"></i><b>6.1</b> Macronix Flash</a></li>
<li class="chapter" data-level="6.2" data-path="external-flash-integration.html"><a href="external-flash-integration.html#database-vs.-filesystem"><i class="fa fa-check"></i><b>6.2</b> Database vs. Filesystem</a><ul>
<li class="chapter" data-level="6.2.1" data-path="external-flash-integration.html"><a href="external-flash-integration.html#flashdb"><i class="fa fa-check"></i><b>6.2.1</b> FlashDB <img src="gfx/org/flashdb.png" /></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="external-flash-integration.html"><a href="external-flash-integration.html#implementation-1"><i class="fa fa-check"></i><b>6.3</b> Implementation</a><ul>
<li class="chapter" data-level="6.3.1" data-path="external-flash-integration.html"><a href="external-flash-integration.html#flashdb-api"><i class="fa fa-check"></i><b>6.3.1</b> FlashDB API</a></li>
<li class="chapter" data-level="6.3.2" data-path="external-flash-integration.html"><a href="external-flash-integration.html#data-base-config-files"><i class="fa fa-check"></i><b>6.3.2</b> Data Base config files</a></li>
<li class="chapter" data-level="6.3.3" data-path="external-flash-integration.html"><a href="external-flash-integration.html#macronix-low-level-driver-functions"><i class="fa fa-check"></i><b>6.3.3</b> Macronix low level driver functions</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="external-flash-integration.html"><a href="external-flash-integration.html#flashdb-evaluation"><i class="fa fa-check"></i><b>6.4</b> FlashDB evaluation</a><ul>
<li class="chapter" data-level="6.4.1" data-path="external-flash-integration.html"><a href="external-flash-integration.html#energy-consumption-1"><i class="fa fa-check"></i><b>6.4.1</b> Energy consumption</a></li>
<li class="chapter" data-level="6.4.2" data-path="external-flash-integration.html"><a href="external-flash-integration.html#github-issue-11-write-performance-on-external-flash"><i class="fa fa-check"></i><b>6.4.2</b> GitHub Issue #11 Write Performance on External Flash</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="gateway.html"><a href="gateway.html"><i class="fa fa-check"></i><b>7</b> Gateway</a><ul>
<li class="chapter" data-level="7.1" data-path="gateway.html"><a href="gateway.html#sensor-gateway-communication-library"><i class="fa fa-check"></i><b>7.1</b> Sensor Gateway Communication Library</a><ul>
<li class="chapter" data-level="7.1.1" data-path="gateway.html"><a href="gateway.html#activate-acceleration-logging"><i class="fa fa-check"></i><b>7.1.1</b> Activate acceleration logging</a></li>
<li class="chapter" data-level="7.1.2" data-path="gateway.html"><a href="gateway.html#deactivate-acceleration-logging"><i class="fa fa-check"></i><b>7.1.2</b> Deactivate acceleration logging</a></li>
<li class="chapter" data-level="7.1.3" data-path="gateway.html"><a href="gateway.html#set-sensor-configuration"><i class="fa fa-check"></i><b>7.1.3</b> Set sensor configuration</a></li>
<li class="chapter" data-level="7.1.4" data-path="gateway.html"><a href="gateway.html#set-sensor-time"><i class="fa fa-check"></i><b>7.1.4</b> Set sensor time</a></li>
<li class="chapter" data-level="7.1.5" data-path="gateway.html"><a href="gateway.html#get-sensor-configuration"><i class="fa fa-check"></i><b>7.1.5</b> Get sensor configuration</a></li>
<li class="chapter" data-level="7.1.6" data-path="gateway.html"><a href="gateway.html#get-sensor-time"><i class="fa fa-check"></i><b>7.1.6</b> Get sensor time</a></li>
<li class="chapter" data-level="7.1.7" data-path="gateway.html"><a href="gateway.html#get-acceleration-data"><i class="fa fa-check"></i><b>7.1.7</b> Get acceleration data</a></li>
<li class="chapter" data-level="7.1.8" data-path="gateway.html"><a href="gateway.html#get-flash-statistics"><i class="fa fa-check"></i><b>7.1.8</b> Get flash statistics</a></li>
<li class="chapter" data-level="7.1.9" data-path="gateway.html"><a href="gateway.html#get-logging-status"><i class="fa fa-check"></i><b>7.1.9</b> Get logging status</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="gateway.html"><a href="gateway.html#advertisement-logging"><i class="fa fa-check"></i><b>7.2</b> Advertisement logging</a></li>
<li class="chapter" data-level="7.3" data-path="gateway.html"><a href="gateway.html#data-storage-format"><i class="fa fa-check"></i><b>7.3</b> Data storage format</a><ul>
<li class="chapter" data-level="7.3.1" data-path="gateway.html"><a href="gateway.html#csv-file-acceleration-logging"><i class="fa fa-check"></i><b>7.3.1</b> Csv file acceleration Logging</a></li>
<li class="chapter" data-level="7.3.2" data-path="gateway.html"><a href="gateway.html#csv-file-advertisement-logging"><i class="fa fa-check"></i><b>7.3.2</b> Csv file advertisement Logging</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="backend.html"><a href="backend.html"><i class="fa fa-check"></i><b>8</b> Backend</a></li>
<li class="chapter" data-level="9" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html"><i class="fa fa-check"></i><b>9</b> BLE GATT Messages</a><ul>
<li class="chapter" data-level="9.1" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#general-message-structure"><i class="fa fa-check"></i><b>9.1</b> General message structure</a></li>
<li class="chapter" data-level="9.2" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#control-messages"><i class="fa fa-check"></i><b>9.2</b> Control messages</a><ul>
<li class="chapter" data-level="9.2.1" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#start-transmitting-acceleration-data"><i class="fa fa-check"></i><b>9.2.1</b> Start transmitting acceleration data</a></li>
<li class="chapter" data-level="9.2.2" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#set-configuration-of-acceleration-sensor"><i class="fa fa-check"></i><b>9.2.2</b> Set configuration of acceleration sensor</a></li>
<li class="chapter" data-level="9.2.3" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#read-configuration-of-acceleration-sensor"><i class="fa fa-check"></i><b>9.2.3</b> Read configuration of acceleration sensor</a></li>
<li class="chapter" data-level="9.2.4" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#set-system-time"><i class="fa fa-check"></i><b>9.2.4</b> Set system time</a></li>
<li class="chapter" data-level="9.2.5" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#read-system-time"><i class="fa fa-check"></i><b>9.2.5</b> Read system time</a></li>
<li class="chapter" data-level="9.2.6" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#control-acceleration-logging"><i class="fa fa-check"></i><b>9.2.6</b> Control acceleration logging</a></li>
<li class="chapter" data-level="9.2.7" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#query-status-of-acceleration-logging"><i class="fa fa-check"></i><b>9.2.7</b> Query status of acceleration logging</a></li>
<li class="chapter" data-level="9.2.8" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#query-flash-statistic"><i class="fa fa-check"></i><b>9.2.8</b> Query flash statistic</a></li>
<li class="chapter" data-level="9.2.9" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#query-boot-counter"><i class="fa fa-check"></i><b>9.2.9</b> Query boot counter</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#response-messages"><i class="fa fa-check"></i><b>9.3</b> Response messages</a><ul>
<li class="chapter" data-level="9.3.1" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#status-response"><i class="fa fa-check"></i><b>9.3.1</b> Status response</a></li>
<li class="chapter" data-level="9.3.2" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#end-of-data-message"><i class="fa fa-check"></i><b>9.3.2</b> End of data message</a></li>
<li class="chapter" data-level="9.3.3" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#configuration-response"><i class="fa fa-check"></i><b>9.3.3</b> Configuration response</a></li>
<li class="chapter" data-level="9.3.4" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#timestamp-response"><i class="fa fa-check"></i><b>9.3.4</b> Timestamp response</a></li>
<li class="chapter" data-level="9.3.5" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#flash-statistic-response"><i class="fa fa-check"></i><b>9.3.5</b> Flash statistic response</a></li>
<li class="chapter" data-level="9.3.6" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#boot-counter-response"><i class="fa fa-check"></i><b>9.3.6</b> boot counter response</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#data-message"><i class="fa fa-check"></i><b>9.4</b> Data message</a><ul>
<li class="chapter" data-level="9.4.1" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#bit-data-format"><i class="fa fa-check"></i><b>9.4.1</b> 12 bit data format</a></li>
<li class="chapter" data-level="9.4.2" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#bit-data-format-1"><i class="fa fa-check"></i><b>9.4.2</b> 10 bit data format</a></li>
<li class="chapter" data-level="9.4.3" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#bit-data-format-2"><i class="fa fa-check"></i><b>9.4.3</b> 8 bit data format</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#communication-example"><i class="fa fa-check"></i><b>9.5</b> Communication example</a></li>
<li class="chapter" data-level="9.6" data-path="ble-gatt-messages.html"><a href="ble-gatt-messages.html#streaming"><i class="fa fa-check"></i><b>9.6</b> Streaming</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="messageobjects.html"><a href="messageobjects.html"><i class="fa fa-check"></i><b>10</b> MessageObjects</a><ul>
<li class="chapter" data-level="10.1" data-path="messageobjects.html"><a href="messageobjects.html#return_values_from_sensor"><i class="fa fa-check"></i><b>10.1</b> return_values_from_sensor</a></li>
<li class="chapter" data-level="10.2" data-path="messageobjects.html"><a href="messageobjects.html#send_msg_object"><i class="fa fa-check"></i><b>10.2</b> send_msg_object</a></li>
</ul></li>
<li class="part"><span><b>To Do</b></span></li>
<li class="chapter" data-level="11" data-path="sensor-1.html"><a href="sensor-1.html"><i class="fa fa-check"></i><b>11</b> Sensor</a><ul>
<li class="chapter" data-level="11.1" data-path="sensor-1.html"><a href="sensor-1.html#hardware"><i class="fa fa-check"></i><b>11.1</b> Hardware</a><ul>
<li class="chapter" data-level="11.1.1" data-path="sensor-1.html"><a href="sensor-1.html#external-flash-memory"><i class="fa fa-check"></i><b>11.1.1</b> External Flash Memory</a></li>
<li class="chapter" data-level="11.1.2" data-path="sensor-1.html"><a href="sensor-1.html#board-redesign"><i class="fa fa-check"></i><b>11.1.2</b> Board Redesign</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="sensor-1.html"><a href="sensor-1.html#software"><i class="fa fa-check"></i><b>11.2</b> Software</a><ul>
<li class="chapter" data-level="11.2.1" data-path="sensor-1.html"><a href="sensor-1.html#general-todo"><i class="fa fa-check"></i><b>11.2.1</b> General ToDo</a></li>
<li class="chapter" data-level="11.2.2" data-path="sensor-1.html"><a href="sensor-1.html#security"><i class="fa fa-check"></i><b>11.2.2</b> Security</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="gateway-1.html"><a href="gateway-1.html"><i class="fa fa-check"></i><b>12</b> Gateway</a><ul>
<li class="chapter" data-level="12.1" data-path="gateway-1.html"><a href="gateway-1.html#hardware-1"><i class="fa fa-check"></i><b>12.1</b> Hardware</a><ul>
<li class="chapter" data-level="12.1.1" data-path="gateway-1.html"><a href="gateway-1.html#uninterruptible-power-supply"><i class="fa fa-check"></i><b>12.1.1</b> Uninterruptible Power Supply</a></li>
<li class="chapter" data-level="12.1.2" data-path="gateway-1.html"><a href="gateway-1.html#camera"><i class="fa fa-check"></i><b>12.1.2</b> Camera</a></li>
<li class="chapter" data-level="12.1.3" data-path="gateway-1.html"><a href="gateway-1.html#g4g5g-module"><i class="fa fa-check"></i><b>12.1.3</b> 3g/4g/5g Module</a></li>
<li class="chapter" data-level="12.1.4" data-path="gateway-1.html"><a href="gateway-1.html#bluetooth-hardware"><i class="fa fa-check"></i><b>12.1.4</b> Bluetooth Hardware</a></li>
<li class="chapter" data-level="12.1.5" data-path="gateway-1.html"><a href="gateway-1.html#case"><i class="fa fa-check"></i><b>12.1.5</b> Case</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="gateway-1.html"><a href="gateway-1.html#software-1"><i class="fa fa-check"></i><b>12.2</b> Software</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="backend-1.html"><a href="backend-1.html"><i class="fa fa-check"></i><b>13</b> Backend</a></li>
<li class="part"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="" data-path="contributors.html"><a href="contributors.html"><i class="fa fa-check"></i>Contributors</a><ul>
<li class="chapter" data-level="" data-path="contributors.html"><a href="contributors.html#ws-2020-2021"><i class="fa fa-check"></i>WS 2020 / 2021</a></li>
<li class="chapter" data-level="" data-path="contributors.html"><a href="contributors.html#ss-2021"><i class="fa fa-check"></i>SS 2021</a></li>
<li class="chapter" data-level="" data-path="contributors.html"><a href="contributors.html#ws-2021-2022"><i class="fa fa-check"></i>WS 2021 / 2022</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="commerical-applications.html"><a href="commerical-applications.html"><i class="fa fa-check"></i>Commerical Applications</a><ul>
<li class="chapter" data-level="" data-path="commerical-applications.html"><a href="commerical-applications.html#literature"><i class="fa fa-check"></i>Literature</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="system-info.html"><a href="system-info.html"><i class="fa fa-check"></i>System Info</a></li>
<li class="divider"></li>
<li><a href="http://www.bchwtz.de" target="blank"><center>www.<b>BCHWTZ</b>.de</center></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Big Data Case Studies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ble-gatt-messages" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> BLE GATT Messages</h1>
<p>Communication between Gateway and Sensor is done via Bluetooth Low Energy. It uses the Nordic UART service which itself uses the Bluetooth GATT protocol.</p>
<p>At the time of writing this document the Sensor supports two generations of messages.</p>
<ol style="list-style-type: decimal">
<li>The first generation was defined in Wintersemester 2020/21. These messages are using header bytes starting at <code>0xFA</code>. Messages which use are reserved by Ruuvi for proprietary messages.</li>
<li>Messages from the second generation use header bytes which are defined in the file ruuvi_endpoints.h.</li>
</ol>
<div id="general-message-structure" class="section level2">
<h2><span class="header-section-number">9.1</span> General message structure</h2>
<p>The general structure of a message is show in the following table.</p>
<table>
<thead>
<tr class="header">
<th>Header</th>
<th>Header</th>
<th>Operation</th>
<th>Parameter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>destination</td>
<td>source</td>
<td>XX</td>
<td>Zero or more Parameter</td>
</tr>
</tbody>
</table>
<p>The first byte <em>destination</em> addresses the service which should process the message. The second byte <em>source</em> contains the source which originated the message.</p>
</div>
<div id="control-messages" class="section level2">
<h2><span class="header-section-number">9.2</span> Control messages</h2>
<p>Control messages are sent to the sensor. They must be padded by nullbytes to a minimum length of 11 bytes. This requirement is introduced by the Ruuvi firmware. The padding bytes are not shown in the following description of the messages.</p>
<div id="start-transmitting-acceleration-data" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Start transmitting acceleration data</h3>
<p>This message starts transmitting of acceleration data. It takes one parameter.</p>
<p>It’s concrete content is: <code>0x4A 0x4A 0x11 P1</code>.</p>
<p>The parameter <code>P1</code> controls the source of the data which should be returned.</p>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>0x01</code></td>
<td>Logged acceleration data from the database should be returned.</td>
</tr>
</tbody>
</table>
<p>Data is transmitted by using data messages. The transmission of the data is followed by a <a href="ble-gatt-messages.html#end-of-data-message">end of data message</a> which signals the end of the data.</p>
<p>If acceleration logging is not active, the Sensor responds a <a href="ble-gatt-messages.html#status-response">status response</a> containing error code <code>RD_ERROR_INVALID_STATE</code>.</p>
</div>
<div id="set-configuration-of-acceleration-sensor" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Set configuration of acceleration sensor</h3>
<p>This message is used to set the configuration of the acceleration sensor (LIS2DH12). The message takes 8 Parameters. The Sensor responds to this message with a <a href="ble-gatt-messages.html#status-response">status response</a>. The parameters are as follows.</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>P1</td>
<td>Rate of sampling in smaples per second. Allowed values are 1Hz, 10Hz, 25Hz, 50Hz, 100Hz, 200Hz, 400Hz (use <code>0xC9</code>).</td>
</tr>
<tr class="even">
<td>P2</td>
<td>Resolution in bits. Allowed values are 8, 10, 12.</td>
</tr>
<tr class="odd">
<td>P3</td>
<td>Measuring range. Allowed values are 2G, 4G, 8G, 16G.</td>
</tr>
<tr class="even">
<td>P4</td>
<td>DSP function. See datasheet of LIS2DH12.</td>
</tr>
<tr class="odd">
<td>P5</td>
<td>DSP parameter. See datasheet of LIS2DH12.</td>
</tr>
<tr class="even">
<td>P6</td>
<td>Mode of operation. Allowed values are <code>0xF2</code>, <code>0xF3</code>, <code>0xF4</code>. See ruuvi_driver_sensor.h for explanation.</td>
</tr>
<tr class="odd">
<td>P7</td>
<td>Frequency divider. This value is used to only save every P7-th value.</td>
</tr>
<tr class="even">
<td>P8</td>
<td>Reserved. Set to <code>0x00</code>.</td>
</tr>
</tbody>
</table>
<p>All values from P1 to P7 can be set to <code>0xFF</code> which means ‘do not change this values’.</p>
<p>The concrete content of this message is <code>0x4A 0x4A 0x02 P1 P2 P3 P4 P5 P6 P7 P8</code>.</p>
</div>
<div id="read-configuration-of-acceleration-sensor" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Read configuration of acceleration sensor</h3>
<p>This message is used to read the configuration of the acceleration sensor (LIS2DH12). The message takes no parameters. The Sensor responds to this message by a <a href="ble-gatt-messages.html#configuration-response">response message which transmits the configuration</a>.</p>
<p>The concrete content of this message is: <code>0x4A 0x4A 0x03</code>.</p>
</div>
<div id="set-system-time" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Set system time</h3>
<p>This message is used to set the RTC of the sensor to a timestamp which is part of the message. The time is expressed in milliseconds. It must be transmitted in <a href="https://en.wikipedia.org/wiki/Endianness#Example">little-endian</a> byte sequence. The sensor responds to this message with a <a href="ble-gatt-messages.html#status-response">status response</a>.</p>
<p>The concrete content of this message is <code>0x21 0x21 0x08 XX XX XX XX XX XX XX XX</code>.</p>
</div>
<div id="read-system-time" class="section level3">
<h3><span class="header-section-number">9.2.5</span> Read system time</h3>
<p>This message is used to read the RTC of the sensor. The sensor responds to this message with a <a href="ble-gatt-messages.html#timestamp-response">timestamp response</a>.</p>
<p>The concrete content of this message is <code>0x21 0x21 0x09</code>.</p>
</div>
<div id="control-acceleration-logging" class="section level3">
<h3><span class="header-section-number">9.2.6</span> Control acceleration logging</h3>
<p>This message is used to activate or deactivate acceleration logging. It takes one parameter. The sensor responds to this message using a <a href="ble-gatt-messages.html#status-response">status response</a>. Activating acceleration logging when it is already active results in an error. Deactivating acceleration logging when it is not active results in an error.</p>
<p>The concrete content of this message is <code>0x4A 0x4A 0x08 P1</code>. Where <code>P1</code> can be a value from the following table.</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>0x00</code></td>
<td>Disable logging.</td>
</tr>
<tr class="even">
<td><code>0x01</code></td>
<td>Logging of acceleration data to flash.</td>
</tr>
<tr class="odd">
<td><code>0x02</code></td>
<td>Logging of acceleration data to RAM. Used for logging of high frequency sampling.</td>
</tr>
</tbody>
</table>
</div>
<div id="query-status-of-acceleration-logging" class="section level3">
<h3><span class="header-section-number">9.2.7</span> Query status of acceleration logging</h3>
<p>This message is used to query the status of acceleration logging. The sensor responds to this message with a <a href="ble-gatt-messages.html#status-response">status response</a>. If logging is active, the response contains the status <code>RD_SUCCESS</code> if logging is not active the status is <code>RD_ERROR_NOT_INITIALIZED</code>.</p>
<p>Streaming is not interpreted as active logging. In that case, this calls returns <code>RD_ERROR_NOT_INITIALIZED</code>.</p>
<p>The concrete content of this message is <code>0x4A 0x4A 0x09</code>.</p>
</div>
<div id="query-flash-statistic" class="section level3">
<h3><span class="header-section-number">9.2.8</span> Query flash statistic</h3>
<p>Flash usage is an important information. It is especially useful for determining when it is needed to download logged acceleration data from the sensor. This message is used to query some statistics about the usage of the internal flash memory of the Nordic NRF52832 MCU. It is implemented as an proprietary message. The sensor responds to this message with a <a href="ble-gatt-messages.html#flash-statistic-response">flash statistic response</a>.</p>
<p>The concrete content of this message is <code>0xFA 0xFA 0x0D</code>.</p>
</div>
<div id="query-boot-counter" class="section level3">
<h3><span class="header-section-number">9.2.9</span> Query boot counter</h3>
<p>This message is used to query the boot counter. It is implemented as an proprietary message. The sensor responds to this message with a <a href="ble-gatt-messages.html#boot-counter-response">boot counter response</a>.</p>
<p>The concrete content of this message is <code>0xFA 0xFA 0x0E</code>.</p>
</div>
</div>
<div id="response-messages" class="section level2">
<h2><span class="header-section-number">9.3</span> Response messages</h2>
<p>Every response message returns a status code as the result of the processing as the third byte. The following table shows the error conditions.</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Value</th>
<th>Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>RD_SUCCESS: No error</td>
</tr>
<tr class="even">
<td>1</td>
<td>RD_ERROR_INTERNAL: Internal Error</td>
</tr>
<tr class="odd">
<td>2</td>
<td>RD_ERROR_NO_MEM: No Memory for operation</td>
</tr>
<tr class="even">
<td>4</td>
<td>RD_ERROR_NOT_FOUND: Not found</td>
</tr>
<tr class="odd">
<td>4</td>
<td>RD_ERROR_NOT_SUPPORTED: Not supported</td>
</tr>
<tr class="even">
<td>5</td>
<td>RD_ERROR_INVALID_PARAM: Invalid Parameter</td>
</tr>
<tr class="odd">
<td>6</td>
<td>RD_ERROR_INVALID_status: Invalid status, operation disallowed in this status</td>
</tr>
<tr class="even">
<td>7</td>
<td>RD_ERROR_INVALID_LENGTH: Invalid Length</td>
</tr>
<tr class="odd">
<td>8</td>
<td>RD_ERROR_INVALID_FLAGS: Invalid Flags</td>
</tr>
<tr class="even">
<td>9</td>
<td>RD_ERROR_INVALID_DATA: Invalid Data</td>
</tr>
<tr class="odd">
<td>10</td>
<td>RD_ERROR_DATA_SIZE: Invalid Data size</td>
</tr>
<tr class="even">
<td>11</td>
<td>RD_ERROR_TIMEOUT: Operation timed out</td>
</tr>
<tr class="odd">
<td>12</td>
<td>RD_ERROR_NULL: Null Pointer</td>
</tr>
<tr class="even">
<td>13</td>
<td>RD_ERROR_FORBIDDEN: Forbidden Operation</td>
</tr>
<tr class="odd">
<td>14</td>
<td>RD_ERROR_INVALID_ADDR: Bad Memory Address</td>
</tr>
<tr class="even">
<td>15</td>
<td>RD_ERROR_BUSY: Flash Busy</td>
</tr>
<tr class="odd">
<td>16</td>
<td>RD_ERROR_RESOURCES: Not enough resources for operation</td>
</tr>
<tr class="even">
<td>17</td>
<td>RD_ERROR_NOT_IMPLEMENTED: Not implemented yet</td>
</tr>
<tr class="odd">
<td>18</td>
<td>RD_ERROR_SELFTEST: Self-test fail</td>
</tr>
<tr class="even">
<td>19</td>
<td>RD_STATUS_MORE_AVAILABLE: Driver has more data queued</td>
</tr>
<tr class="odd">
<td>20</td>
<td>RD_ERROR_NOT_INITIALIZED: Driver is not initialized.</td>
</tr>
<tr class="even">
<td>21</td>
<td>RD_ERROR_NOT_ACKNOWLEDGED: Ack was expected but not received</td>
</tr>
<tr class="odd">
<td>22</td>
<td>RD_ERROR_NOT_ENABLED: Driver is not enabled</td>
</tr>
</tbody>
</table>
<div id="status-response" class="section level3">
<h3><span class="header-section-number">9.3.1</span> Status response</h3>
<p>This message is used to return a status code to the gateway if no other information is available.</p>
<table>
<thead>
<tr class="header">
<th>Header</th>
<th>Header</th>
<th>Operation</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>destination</td>
<td>source</td>
<td>operation</td>
<td>SS</td>
</tr>
</tbody>
</table>
<p>Where <code>SS</code> is the status code. See above table.</p>
<p>The header bytes <em>destination</em> and <em>source</em> are the same bytes from the control message but in reversed order. The third byte <em>operation</em> is equal to the byte <em>operation</em> from the control message which caused this response.</p>
</div>
<div id="end-of-data-message" class="section level3">
<h3><span class="header-section-number">9.3.2</span> End of data message</h3>
<p>This message is sent to the gateway after returning data. It signals the end of the transmission. This message contains nine parameters. The current configuration of the acceleration sensor are the first eight parameter. The structure is the same as shown in the <a href="ble-gatt-messages.html#set-configuration-of-acceleration-sensor">set configuration message</a>. The CRC16 value of the transmitted data is the 9th parameter.</p>
<p>To compute the CRC16 value the polynom <code>0x11021</code> with the initial value <code>0xFFFF</code> is used. The output bytes are not reversed and not XOR’d. The CRC value is of size 2 bytes. It is transfered in <a href="https://en.wikipedia.org/wiki/Endianness#Example">little-endian</a> byte sequence.</p>
<p>The concrete content of this message is <code>0x4A 0x4A 0x11 SS P1 P2 P3 P4 P5 P6 P7 P8 CRC1 CRC2</code>.</p>
<p>Where <code>SS</code> is the status code. See above table.</p>
</div>
<div id="configuration-response" class="section level3">
<h3><span class="header-section-number">9.3.3</span> Configuration response</h3>
<p>This message is sent to the gateway after requesting the current configuration. The message contains eight parameters containing the current configuration. If the status code signals an error the transmitted values is undefined.</p>
<p>The concrete content of this message is <code>0x4A 0x4A 0x03 SS P1 P2 P3 P4 P5 P6 P7 P8</code>. The values P1 to P8 map to the same values as shown in <a href="ble-gatt-messages.html#set-configuration-of-acceleration-sensor">set configuration message</a>.</p>
<p>Where <code>SS</code> is the status code. See above table.</p>
</div>
<div id="timestamp-response" class="section level3">
<h3><span class="header-section-number">9.3.4</span> Timestamp response</h3>
<p>This message is sent to the gateway after requesting the system time. The message contains one parameter. The parameter is a 8 byte value containing the current timestamp. The bytes are transferred in <a href="https://en.wikipedia.org/wiki/Endianness#Example">little-endian</a> sequence. If the status code signals an error the transmitted value is undefined.</p>
<p>The concrete content of this message is <code>0x21 0x21 0x09 SS XX XX XX XX XX XX XX XX</code>. Where <code>SS</code> is the status code.</p>
</div>
<div id="flash-statistic-response" class="section level3">
<h3><span class="header-section-number">9.3.5</span> Flash statistic response</h3>
<p>The sensor responds to the control message for querying the flash statistic using the following response. Most values were retrived using <code>fds_stat()</code> from Nordic Softdevice. The message contains 11 parameters.</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Byte</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>0xFB</code></td>
<td>Header</td>
</tr>
<tr class="even">
<td>2</td>
<td><code>0x0D</code></td>
<td>Header</td>
</tr>
<tr class="odd">
<td>3</td>
<td>SS</td>
<td>Status byte regarding this operation.</td>
</tr>
<tr class="even">
<td>4</td>
<td>LS</td>
<td>Status regarding the background logging operation.</td>
</tr>
<tr class="odd">
<td>5</td>
<td>start</td>
<td>Unused <code>0xFF</code>.</td>
</tr>
<tr class="even">
<td>6</td>
<td>end</td>
<td>Unused <code>0xFF</code>.</td>
</tr>
<tr class="odd">
<td>8</td>
<td>size</td>
<td>Unused <code>0xFF</code>.</td>
</tr>
<tr class="even">
<td>9-10</td>
<td>valid records</td>
<td>The number of valid records.</td>
</tr>
<tr class="odd">
<td>10-11</td>
<td>dirty records</td>
<td>The number of deleted (“dirty”) records.</td>
</tr>
<tr class="even">
<td>12-13</td>
<td>words reserved</td>
<td>The number of words reserved.</td>
</tr>
<tr class="odd">
<td>14-15</td>
<td>words used</td>
<td>The number of words written to flash, including those reserved for future writes.</td>
</tr>
<tr class="even">
<td>16-17</td>
<td>largest continious</td>
<td>The largest number of free contiguous words in the file system.</td>
</tr>
<tr class="odd">
<td>18-19</td>
<td>freeable words</td>
<td>The largest number of words that can be reclaimed by garbage collection.</td>
</tr>
</tbody>
</table>
<p>Multi byte values are transmitted in <a href="https://en.wikipedia.org/wiki/Endianness#Example">little-endian</a> byte sequence.</p>
</div>
<div id="boot-counter-response" class="section level3">
<h3><span class="header-section-number">9.3.6</span> boot counter response</h3>
<p>This message is sent to the gateway after requesting the boot counter. The message contains one parameter. The parameter is a 4 byte value containing the value. The bytes are transferred in <a href="https://en.wikipedia.org/wiki/Endianness#Example">little-endian</a> sequence. If the status code signals an error the transmitted value is undefined.</p>
<p>The concrete content of this message is <code>0xFB 0x0E SS XX XX XX XX</code>. Where <code>SS</code> is the status code.</p>
</div>
</div>
<div id="data-message" class="section level2">
<h2><span class="header-section-number">9.4</span> Data message</h2>
<p>Data messages are used to transfer logged acceleration data. A data message starts with the byte <code>0x11</code>. After the start byte there follows up to 19 bytes of data.</p>
<p>The concrete content of this message is <code>0x11 XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX</code>.</p>
<p>The data is returned in blocks of 32 tuples of x-, y-, z-values. Every block is preceded by the timestamp when the interrupt occured which this block generates. To decode the data block the information about the resolution and the scale is needed. This information is transmitted by the <a href="ble-gatt-messages.html#end-of-data-message">end of data message</a>. All values are transferred in <a href="https://en.wikipedia.org/wiki/Endianness#Example">little-endian</a> byte sequence.</p>
<p>After de-compacting every value must be interpreted as the most significant part of an 16 bit wide signed integer. To get the real acceleration value from this intermediate value multiply it by one of the following factors.</p>
<table>
<thead>
<tr class="header">
<th>Scale / Resolution</th>
<th>8 bit</th>
<th>10 bit</th>
<th>12 bit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2G</td>
<td><span class="math inline">\(\frac{16}{256*1000}\)</span></td>
<td><span class="math inline">\(\frac{4}{64*1000}\)</span></td>
<td><span class="math inline">\(\frac{1}{16*1000}\)</span></td>
</tr>
<tr class="even">
<td>4G</td>
<td><span class="math inline">\(\frac{32}{256*1000}\)</span></td>
<td><span class="math inline">\(\frac{8}{64*1000}\)</span></td>
<td><span class="math inline">\(\frac{2}{16*1000}\)</span></td>
</tr>
<tr class="odd">
<td>8G</td>
<td><span class="math inline">\(\frac{64}{256*1000}\)</span></td>
<td><span class="math inline">\(\frac{16}{64*1000}\)</span></td>
<td><span class="math inline">\(\frac{4}{16*1000}\)</span></td>
</tr>
<tr class="even">
<td>16G</td>
<td><span class="math inline">\(\frac{192}{256*1000}\)</span></td>
<td><span class="math inline">\(\frac{48}{64*1000}\)</span></td>
<td><span class="math inline">\(\frac{12}{16*1000}\)</span></td>
</tr>
</tbody>
</table>
<div id="bit-data-format" class="section level3">
<h3><span class="header-section-number">9.4.1</span> 12 bit data format</h3>
<p>In 12 bit resolution mode two values are transmitted inside 3 bytes. See following figure.</p>
<p><img src="gfx/org/bitpack12.png" /></p>
</div>
<div id="bit-data-format-1" class="section level3">
<h3><span class="header-section-number">9.4.2</span> 10 bit data format</h3>
<p>In 10 bit resolution mode four values are transmitted inside 5 bytes. See following figure.</p>
<p><img src="gfx/org/bitpack10.png" /></p>
</div>
<div id="bit-data-format-2" class="section level3">
<h3><span class="header-section-number">9.4.3</span> 8 bit data format</h3>
<p>In 8 bit resolution mode every value is transmitted seperatly. See following figure.</p>
<p><img src="gfx/org/bitpack8.png" /></p>
</div>
</div>
<div id="communication-example" class="section level2">
<h2><span class="header-section-number">9.5</span> Communication example</h2>
<p>The following figure shows an example communication.</p>
<p><img src="gfx/org/GATT-communication-example.png" /></p>
</div>
<div id="streaming" class="section level2">
<h2><span class="header-section-number">9.6</span> Streaming</h2>
<p>Streaming of acceleration data can be activated to retrieve acceleration data at high sampling frequencies. To enable this operation mode logging must be currently disabled. Streaming can not be persistent enabled. It remains active until deactivation using <a href="ble-gatt-messages.html#control-acceleration-logging">Control acceleration logging</a> command or until power cycle.</p>
<p>If streaming is active but no one is connected to BLE GATT service energy consumption is not significant higher than operating the acceleration sensor at this sampling frequency without logging the data.</p>
<p>Transfer of sampled data is automatically startet if someone is connected to BLE GATT service. In this case, the data is immediately send to the gateway using the following structure. The concrete content of a message is the following.</p>
<p><code>0x11 TT TT TT TT TT TT TT TT XX XX XX XX XX XX XX XX XX</code></p>
<p>Each message contains two parameters:</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>TT TT TT TT TT TT TT TT</code></td>
<td>Timestamp of sampling the following value.</td>
</tr>
<tr class="even">
<td><code>XX XX XX XX XX XX XX XX XX</code></td>
<td>Acceleration values. Each message transports two tuples of X-, Y-, Z-Acceleration values in compacted format. I.e. without unused bits.</td>
</tr>
</tbody>
</table>
<p>Multi byte values are transmitted in <a href="https://en.wikipedia.org/wiki/Endianness#Example">little-endian</a> byte sequence. This is relevant for timestamp and acceleration values.</p>
<p>To decode the acceleration values one must know the current configuration of the sensor. This information is not part of this message. So, one must save this information from the setup of streaming.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="backend.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="messageobjects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/14-docs-messages.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bchwtz-bdcs.pdf", "bchwtz-bdcs.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
